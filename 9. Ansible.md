# Automation Using Ansible
--------------------------


## VMs Needed for This Example
-------------------------------

1) Master machine.
2) One or more slave nodes.

`For simplicity make all usernames and password on all hosts unified` 

## Requirements
--------------------------

1) OpenSSH Installed on all Hosts.

```bash
sudo apt install openssh-server
```
2) Create SSH key and send the public key to slave nodes:

```bash
master$ ssh-keygen -t ed25519 -C "Ansible"
master$ ssh-copy-id -i ~/.ssh/ansible.pub [slave_IP]
```
3) Install ansible on master node:

```bash
sudo apt update
sudo apt install ansible
```

## Ansible Configuration on Master Node
-------------------------------------------

Create a file named `inventory` containing all slave node IPs as a list.

```ansible
[slaves]
192.168.1.10
192.168.1.11
192.168.1.12
[slaves:vars]
ansible_password=student
ansible_ssh_user=student
host_key_checking=False
```
create a file named `ansible.cfg`:

```ansible.cfg
[defaults]
inventory=inventory
private_key_file=~/.ssh/ansible

[privilege_escalation]
become = True
become_method = sudo
become_user = root
```
To test conectivity:

```bash
ansible all -m ping
```
Some ansinble commands:

```bash
ansible all --list-hosts
ansible all -m gather_facts
ansible all -m apt -a update_cache=true --become --ask-become-pass
ansible all -m apt -a "name=apache2" --become --ask-become-pass
```

## Ansible Playbooks
-------------------------

### Install a Package
--------------------

Create a file named `install_apache.yml`:
```yml
---
- hosts: all
  become: true
  tasks:
  - name: install apache2 package
    apt:
      name: apache2
```

To run the playbook:

```bash
ansibel-playbook --ask-become-pass install_apache.yml
```